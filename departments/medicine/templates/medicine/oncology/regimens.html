{% extends "base.html" %}
{% block content %}
  <style>
    .nav-pills .nav-link { color: #343a40; background-color: #f8f9fa; border-radius: 0.25rem; margin: 0.2rem; transition: all 0.3s ease; }
    .nav-pills .nav-link:hover { color: #0056b3; background-color: #e9ecef; }
    .nav-pills .nav-link.active { color: #ffffff; background-color: #007bff; font-weight: bold; }
    .filter-form { margin-bottom: 1.5rem; }
  </style>
  <div class="mb-4">
    <nav class="nav nav-pills flex-column flex-sm-row">
      <a class="nav-link" href="{{ url_for('medicine.oncology') }}">Search Patient</a>
      <a class="nav-link" href="{{ url_for('medicine.patients_list') }}">Patients List</a>
      <a class="nav-link" href="{{ url_for('medicine.drugs') }}">Drugs</a>
      <a class="nav-link active" href="{{ url_for('medicine.regimens') }}">Regimens</a>
      <a class="nav-link" href="{{ url_for('medicine.warnings') }}">Warnings</a>
    </nav>
  </div>
  <div class="card shadow-sm">
    <div class="card-body">
      <h5 class="card-title fw-bold text-primary">Oncology Regimens</h5>
      <form class="filter-form" method="GET">
        <div class="row">
          <div class="col-md-4">
            <label for="category_id">Filter by Category</label>
            <select name="category_id" id="category_id" class="form-control">
              <option value="">All Categories</option>
              {% for category in categories %}
                <option value="{{ category.id }}" {% if selected_category == category.id %}selected{% endif %}>
                  {{ category.name }}
                </option>
              {% endfor %}
            </select>
          </div>
          <div class="col-md-4">
            <label for="status">Filter by Status</label>
            <select name="status" id="status" class="form-control">
              <option value="">All Statuses</option>
              <option value="Active" {% if selected_status == 'Active' %}selected{% endif %}>Active</option>
              <option value="Deprecated" {% if selected_status == 'Deprecated' %}selected{% endif %}>Deprecated</option>
              <option value="Under Review" {% if selected_status == 'Under Review' %}selected{% endif %}>Under Review</option>
            </select>
          </div>
          <div class="col-md-4 align-self-end">
            <button type="submit" class="btn btn-primary">Apply Filters</button>
          </div>
        </div>
      </form>
      {% if regimens %}
        <ul class="list-group">
          {% for regimen in regimens %}
            <li class="list-group-item">
              <strong>{{ regimen.name }}</strong><br>
              <small>
                Category: {{ regimen.category.name if regimen.category else 'N/A' }}<br>
                Indication: {{ regimen.primary_indication or 'N/A' }}<br>
                Status: {{ regimen.status }}<br>
                Cycles: {{ regimen.total_cycles }} ({{ regimen.cycle_duration_days }} days each)<br>
                Contraindications: {{ regimen.contraindications or 'N/A' }}<br>
                Drugs:
                {% for assoc in regimen.drugs %}
                  {{ assoc.drug.name }} (Dose: {{ assoc.dose or 'N/A' }}, Schedule: {{ assoc.administration_schedule or 'N/A' }}, Route: {{ assoc.administration_route or 'N/A' }}){% if not loop.last %}, {% endif %}
                {% else %}
                  None
                {% endfor %}
              </small>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <p>No regimens found.</p>
      {% endif %}
    </div>
  </div>
{% endblock %}